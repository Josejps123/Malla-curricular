<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Ingeniería Civil de Minas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2e3a59;
    }
    .malla {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
    }
    .semestre {
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    .semestre h2 {
      font-size: 16px;
      margin-top: 0;
      color: #005b96;
    }
    .asignatura {
      margin-bottom: 5px;
      padding: 5px;
      border-left: 4px solid #005b96;
      background-color: #e9f1f7;
      transition: all 0.3s;
      opacity: 0.4;
      pointer-events: none;
    }
    .asignatura.desbloqueada {
      opacity: 1;
      pointer-events: auto;
    }
    .asignatura.aprobada {
      background-color: #b6e2b6 !important;
      border-left-color: #2e8b57 !important;
    }
    .creditos {
      font-size: 12px;
      color: #555;
    }
    @media (max-width: 900px) {
      .malla {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <h1>Malla Curricular Ingeniería Civil de Minas</h1>
  <p id="creditos-totales">Créditos aprobados: 0</p>
  <button id="reset">Reiniciar progreso</button>
  <div class="malla">
    <!-- (asignaturas existentes aquí, sin cambios necesarios para esta lógica) -->
  </div>

  <script>
    const prerrequisitos = {
      "MAT117": ["MAT115"],
      "MAT215": ["MAT117"],
      "MAT217": ["MAT215"],
      "EST224": ["MAT215"],
      "FIS231": ["FIS131"],
      "FIS331": ["FIS231"],
      "EIQ150": ["MIN140"],
      "EIQ356": ["EIQ342"],
      "EIQ242": ["EIQ150"],
      "QUI220": ["QUI222"],
      "EIQ250": ["MIN140"],
      "MIN320": ["QUI220"],
      "MIN360": ["MIN320"],
      "MIN375": ["FIS231"],
      "MIN380": ["EIE349"],
      "MIN388": ["MIN330"],
      "MIN410": ["MIN360"],
      "MIN420": ["MIN320"],
      "MIN430": ["MIN330"],
      "MIN444": ["MIN330"],
      "MIN440": ["EIQ356"],
      "MIN460": ["MIN410", "MIN380"],
      "MIN470": ["MIN420"],
      "MIN480": ["MIN330"],
      "MIN485": ["MIN388"],
      "MIN510": ["MIN460"],
      "MIN520": ["MIN430"],
      "MIN540": ["MIN485"],
      "MIN560": ["MIN460"],
      "MIN570": ["MIN480"],
      "MIN620": ["EII604"],
      "MIN630": ["EIQ657", "EII609"],
      "MIN640": ["MIN590"],
      "MIN680": ["MIN640"],
      "ING9002": ["ING9001"],
      "ING9003": ["ING9002"],
      "ING9004": ["ING9003"],
      "EIQ657": ["EII604"],
      "EIQ542": ["MIN440"],
      "EII609": ["EIQ542"],
      "EIE349": ["FIS331"],
      "DER404": ["MIN430"],
      "EII604": ["ICA533"]
    };

    const creditosNecesarios = {
      "ING9001": 19,
      "MIN310": 55,
      "ICA533": 90,
      "MIN590": 170
    };

    const asignaturas = document.querySelectorAll('.asignatura');
    let aprobadas = JSON.parse(localStorage.getItem('aprobadas')) || [];

    function actualizarEstado() {
      let totalCreditos = 0;

      asignaturas.forEach(asig => {
        const sigla = asig.dataset.sigla;
        if (aprobadas.includes(sigla)) {
          const creditosText = asig.querySelector('.creditos')?.textContent || '';
          const match = creditosText.match(/(\d+)/);
          if (match) totalCreditos += parseInt(match[1]);
        }
      });
      document.getElementById('creditos-totales').textContent = `Créditos aprobados: ${totalCreditos}`;

      asignaturas.forEach(asig => {
        const sigla = asig.dataset.sigla;
        const prereqs = prerrequisitos[sigla] || [];
        const requiereCreditos = creditosNecesarios[sigla] || 0;
        const puedeDesbloquear = prereqs.every(pr => aprobadas.includes(pr)) && totalCreditos >= requiereCreditos;

        asig.classList.remove('aprobada', 'desbloqueada');

        if (aprobadas.includes(sigla)) {
          asig.classList.add('aprobada');
          asig.classList.add('desbloqueada');
        } else if ((prereqs.length === 0 || puedeDesbloquear)) {
          asig.classList.add('desbloqueada');
        }
      });
    }

    asignaturas.forEach(asig => {
      asig.addEventListener('click', () => {
        const sigla = asig.dataset.sigla;
        const esDesbloqueada = asig.classList.contains('desbloqueada');

        if (!esDesbloqueada) return;

        if (aprobadas.includes(sigla)) {
          aprobadas = aprobadas.filter(s => s !== sigla);
        } else {
          aprobadas.push(sigla);
        }

        localStorage.setItem('aprobadas', JSON.stringify(aprobadas));
        actualizarEstado();
      });
    });

    document.getElementById('reset').addEventListener('click', () => {
      if (confirm("¿Estás seguro de que quieres reiniciar tu progreso?")) {
        localStorage.removeItem('aprobadas');
        aprobadas = [];
        actualizarEstado();
      }
    });

    actualizarEstado();
  </script>
</body>
</html>

